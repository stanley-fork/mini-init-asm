#!/usr/bin/make -f

export DH_VERBOSE = 1

%:
	dh $@

override_dh_auto_build:
	arch=$$(dpkg-architecture -qDEB_HOST_ARCH); \
	case "$$arch" in \
	  amd64) $(MAKE) DEBUG=0 build-amd64; cp build/mini-init-amd64 build/mini-init-asm ;; \
	  arm64) $(MAKE) DEBUG=0 build-arm64; cp build/mini-init-arm64 build/mini-init-asm ;; \
	  *) echo "Unsupported architecture: $$arch" >&2; exit 1 ;; \
	esac

override_dh_auto_test:
	bash scripts/test_harness.sh build/mini-init-asm
	bash scripts/test_ep_signals.sh build/mini-init-asm
	bash scripts/test_edge_cases.sh build/mini-init-asm
	bash scripts/test_exit_code_mapping.sh build/mini-init-asm
	bash scripts/test_restart.sh build/mini-init-asm
	bash scripts/test_diagnostics.sh build/mini-init-asm

override_dh_auto_clean:
	$(MAKE) clean
